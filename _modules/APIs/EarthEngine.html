

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>APIs.EarthEngine &mdash; mcimageprocessing  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            mcimageprocessing
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Readme</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../history.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">mcimageprocessing</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">APIs.EarthEngine</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for APIs.EarthEngine</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClassVar</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ee</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geemap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipyfilechooser</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">widgets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Extra</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">root_validator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">shape</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">mcimageprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">config_manager</span>


<div class="viewcode-block" id="EarthEngineManager">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EarthEngineManager</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">year_ranges</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vis_params</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;NDVI&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;FFFFFF&#39;</span><span class="p">,</span> <span class="s1">&#39;CE7E45&#39;</span><span class="p">,</span> <span class="s1">&#39;DF923D&#39;</span><span class="p">,</span> <span class="s1">&#39;F1B555&#39;</span><span class="p">,</span> <span class="s1">&#39;FCD163&#39;</span><span class="p">,</span> <span class="s1">&#39;99B718&#39;</span><span class="p">,</span>
                <span class="s1">&#39;74A901&#39;</span><span class="p">,</span> <span class="s1">&#39;66A000&#39;</span><span class="p">,</span> <span class="s1">&#39;529400&#39;</span><span class="p">,</span> <span class="s1">&#39;3E8601&#39;</span><span class="p">,</span> <span class="s1">&#39;207401&#39;</span><span class="p">,</span> <span class="s1">&#39;056201&#39;</span><span class="p">,</span>
                <span class="s1">&#39;004C00&#39;</span><span class="p">,</span> <span class="s1">&#39;023B01&#39;</span><span class="p">,</span> <span class="s1">&#39;012E01&#39;</span><span class="p">,</span> <span class="s1">&#39;011D01&#39;</span><span class="p">,</span> <span class="s1">&#39;011301&#39;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">ee_dates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Class-level aggregation functions that do not change and are not instance-specific</span>
    <span class="n">aggregation_functions</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">mode</span><span class="p">(),</span>
        <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
        <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
        <span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
        <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;system:time_start&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">()</span>

<div class="viewcode-block" id="EarthEngineManager.load_credentials">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.load_credentials">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Assuming `config_manager` is defined elsewhere and loaded appropriately</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ServiceAccountCredentials</span><span class="p">(</span>
            <span class="n">email</span><span class="o">=</span><span class="n">config_manager</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;KEYS&#39;</span><span class="p">][</span><span class="s1">&#39;GEE&#39;</span><span class="p">][</span><span class="s1">&#39;client_email&#39;</span><span class="p">],</span>
            <span class="n">key_data</span><span class="o">=</span><span class="n">config_manager</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;KEYS&#39;</span><span class="p">][</span><span class="s1">&#39;GEE&#39;</span><span class="p">][</span><span class="s1">&#39;private_key&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span></div>


<div class="viewcode-block" id="EarthEngineManager.validate_aggregation_function">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.validate_aggregation_function">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_aggregation_function</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">function</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aggregation_functions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid aggregation function: </span><span class="si">{</span><span class="n">function</span><span class="si">}</span><span class="s2">. Must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">aggregation_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">function</span></div>


<div class="viewcode-block" id="EarthEngineManager.generate_monthly_date_ranges">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.generate_monthly_date_ranges">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_monthly_date_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param start_date: The start date of the date ranges to generate. Should be a datetime.date object.</span>
<span class="sd">        :param end_date: The end date of the date ranges to generate. Should be a datetime.date object.</span>
<span class="sd">        :return: A list of tuples, where each tuple represents a monthly date range. Each tuple contains the start date and end date of the respective month.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">date_ranges</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
                <span class="c1"># Skip months before the start month in the start year</span>
                <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span> <span class="ow">and</span> <span class="n">month</span> <span class="o">&lt;</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># Stop if the month is after the end month in the end year</span>
                <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span> <span class="ow">and</span> <span class="n">month</span> <span class="o">&gt;</span> <span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="c1"># Get the last day of the month</span>
                <span class="n">last_day</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># Format the start and end dates of the month</span>
                <span class="n">month_start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">month_end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">last_day</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="c1"># Append the tuple of the start and end date of the month to the list</span>
                <span class="n">date_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">month_start_date</span><span class="p">,</span> <span class="n">month_end_date</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">date_ranges</span></div>


<div class="viewcode-block" id="EarthEngineManager.generate_yearly_date_ranges">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.generate_yearly_date_ranges">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_yearly_date_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param start_date: The start date of the date range.</span>
<span class="sd">        :param end_date: The end date of the date range.</span>
<span class="sd">        :return: A list of tuples, where each tuple represents the start and end dates for each year within the specified range.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert start and end dates from strings to date objects</span>
        <span class="c1"># start_date_dt = datetime.datetime.strptime(start_date, &#39;%Y-%m-%d&#39;)</span>
        <span class="c1"># end_date_dt = datetime.datetime.strptime(end_date, &#39;%Y-%m-%d&#39;)</span>

        <span class="c1"># Check if end_date is supplied and valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">end_date</span> <span class="ow">or</span> <span class="n">end_date</span> <span class="o">&lt;</span> <span class="n">start_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The end date must be provided and must be after the start date.&quot;</span><span class="p">)</span>

        <span class="n">date_ranges</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Determine the start of the year</span>
            <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
                <span class="n">year_start_date</span> <span class="o">=</span> <span class="n">start_date</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year_start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Determine the end of the year</span>
            <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
                <span class="n">year_end_date</span> <span class="o">=</span> <span class="n">end_date</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">year_end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>

            <span class="c1"># Format the start and end dates of the year</span>
            <span class="n">year_start_date_str</span> <span class="o">=</span> <span class="n">year_start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">year_end_date_str</span> <span class="o">=</span> <span class="n">year_end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Append the tuple of the start and end date of the year to the list</span>
            <span class="n">date_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">year_start_date_str</span><span class="p">,</span> <span class="n">year_end_date_str</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">date_ranges</span></div>


<div class="viewcode-block" id="EarthEngineManager.get_image_collection_dates">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.get_image_collection_dates">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_collection_dates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">min_max_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param collection: The name of the image collection to retrieve dates from. It should be in the format &#39;path/to/collection&#39;.</span>
<span class="sd">        :param min_max_only: A boolean value indicating whether to only return the minimum and maximum dates in the collection. Default is False.</span>
<span class="sd">        :return: A list of dates in the image collection. If `min_max_only` is True, it will return a list with two dates, representing the minimum and maximum dates in the collection. Otherwise</span>
<span class="sd">        *, it will return a list of all dates in the collection.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Regular expression to match both formats</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;^[A-Za-z0-9_-]+(?:/[A-Za-z0-9_-]+){1,2}$&#39;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">format_dates</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
            <span class="n">original_date</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;system:time_start&#39;</span><span class="p">))</span>
            <span class="n">current_day</span> <span class="o">=</span> <span class="n">original_date</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;YYYY-MM-dd&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;current_date&#39;</span><span class="p">:</span> <span class="n">current_day</span><span class="p">})</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_min_max_dates</span><span class="p">(</span><span class="n">collection</span><span class="p">):</span>
            <span class="c1"># Get the minimum date in the collection.</span>
            <span class="n">min_date</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">aggregate_min</span><span class="p">(</span><span class="s1">&#39;system:time_start&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;YYYY-MM-dd&#39;</span><span class="p">)</span>
            <span class="c1"># Get the maximum date in the collection.</span>
            <span class="n">max_date</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">collection</span><span class="o">.</span><span class="n">aggregate_max</span><span class="p">(</span><span class="s1">&#39;system:time_start&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;YYYY-MM-dd&#39;</span><span class="p">)</span>

            <span class="n">min_date</span> <span class="o">=</span> <span class="n">min_date</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

            <span class="n">max_date</span> <span class="o">=</span> <span class="n">max_date</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">[</span><span class="n">min_date</span><span class="p">,</span> <span class="n">max_date</span><span class="p">]</span>

        <span class="n">collection</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">min_max_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_min_max_dates</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">formatted_dates</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">format_dates</span><span class="p">)</span>
            <span class="n">current_date_list</span> <span class="o">=</span> <span class="n">formatted_dates</span><span class="o">.</span><span class="n">aggregate_array</span><span class="p">(</span><span class="s1">&#39;current_date&#39;</span><span class="p">)</span>
            <span class="n">ee_date_list</span> <span class="o">=</span> <span class="n">current_date_list</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ee_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ee_date_list</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ee_dates</span></div>



<div class="viewcode-block" id="EarthEngineManager.calculate_statistics">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.calculate_statistics">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param img: The image on which to calculate the statistics.</span>
<span class="sd">        :param geometry: The geometry within which to calculate the statistics.</span>
<span class="sd">        :param band: The band of the image on which to calculate the statistics.</span>
<span class="sd">        :return: The calculated statistics as a dictionary.</span>

<span class="sd">        This method calculates various statistics for a given image within a specified geometry and band. It uses the Earth Engine reducers to calculate mean, sum, maximum, minimum, standard</span>
<span class="sd">        * deviation, variance, and median.</span>

<span class="sd">        The `img` parameter is the image object on which the statistics are calculated.</span>
<span class="sd">        The `geometry` parameter is the geometry object that defines the region within which the statistics are calculated.</span>
<span class="sd">        The `band` parameter is the name of the band on which the statistics are calculated.</span>

<span class="sd">        The method returns the calculated statistics as a dictionary. The keys of the dictionary represent the statistic types (&#39;mean&#39;, &#39;sum&#39;, &#39;max&#39;, &#39;min&#39;, &#39;stdDev&#39;, &#39;variance&#39;, &#39;median&#39;) and</span>
<span class="sd">        * the values represent the computed statistics for each type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define the reducers for each statistic you want to calculate</span>
        <span class="n">reducers</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
            <span class="n">reducer2</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
            <span class="n">sharedInputs</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
            <span class="n">reducer2</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="n">sharedInputs</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
            <span class="n">reducer2</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="n">sharedInputs</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
            <span class="n">reducer2</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">stdDev</span><span class="p">(),</span>
            <span class="n">sharedInputs</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
            <span class="n">reducer2</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">variance</span><span class="p">(),</span>
            <span class="n">sharedInputs</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span>
            <span class="n">reducer2</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
            <span class="n">sharedInputs</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># Apply the reducers to the image</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span><span class="n">reducer</span><span class="o">=</span><span class="n">reducers</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">maxPixels</span><span class="o">=</span><span class="mf">1e12</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stats</span></div>


<div class="viewcode-block" id="EarthEngineManager.get_image">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.get_image">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">multi_date</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                  <span class="n">aggregation_period</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">aggregation_method</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">start_date</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">end_date</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">date</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">create_sub_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">image_collection</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">add_to_map</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">band</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">additional_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">filter_argument</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">geometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">statistics_only</span><span class="o">=</span><span class="kc">False</span>
                  <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param multi_date: Boolean indicating whether multiple dates will be used for aggregation</span>
<span class="sd">        :param aggregation_period: String indicating the period over which to aggregate the images</span>
<span class="sd">        :param aggregation_method: String indicating the method of aggregation to be used</span>
<span class="sd">        :param start_date: String indicating the start date of the image collection</span>
<span class="sd">        :param end_date: String indicating the end date of the image collection</span>
<span class="sd">        :param date: String indicating the date for which to retrieve the image</span>
<span class="sd">        :param create_sub_folder: Boolean indicating whether to create a subfolder for the downloaded image</span>
<span class="sd">        :param scale: Scale at which to retrieve the image. Default is None.</span>
<span class="sd">        :param image_collection: String indicating the Earth Engine image collection to use</span>
<span class="sd">        :param add_to_map: Boolean indicating whether to add the retrieved image to the map</span>
<span class="sd">        :param band: String indicating the band to retrieve from the image collection</span>
<span class="sd">        :param additional_filter: Boolean indicating whether to apply an additional filter to the image collection</span>
<span class="sd">        :param filter_argument: Argument to be used for additional filtering. Default is None.</span>
<span class="sd">        :param geometry: Geometry object representing the region of interest</span>
<span class="sd">        :param statistics_only: Boolean indicating whether to only return additional statistics about the image</span>
<span class="sd">        :return: Tuple containing the retrieved image, the boundary of the region, and the nominal scale of the image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">multi_date</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">validate_aggregation_function</span><span class="p">(</span><span class="n">aggregation_method</span><span class="p">)</span>

            <span class="n">img_function</span> <span class="o">=</span> <span class="n">EarthEngineManager</span><span class="o">.</span><span class="n">aggregation_functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aggregation_method</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">img_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid aggregation function: </span><span class="si">{</span><span class="n">aggregation_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>



            <span class="n">boundary</span> <span class="o">=</span> <span class="n">geometry</span>

            <span class="n">img_collection</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">image_collection</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span>

            <span class="n">ee_img_scale</span> <span class="o">=</span> <span class="n">img_collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">projection</span><span class="p">()</span><span class="o">.</span><span class="n">nominalScale</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

            <span class="n">mask</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">aggregation_functions</span><span class="p">[</span><span class="n">aggregation_method</span><span class="p">](</span><span class="n">img_collection</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span>


            <span class="c1"># Step 1: Mask where value is not -9999</span>
            <span class="n">valid_pixels</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">neq</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>

            <span class="c1"># Step 2: Combine valid_pixels mask with nigeria_mask</span>
            <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">valid_pixels</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

            <span class="c1"># Step 3: Use the combined mask to mask the aggregated image</span>
            <span class="n">img_masked</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">combined_mask</span><span class="p">)</span>

            <span class="n">nodata_value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">img_masked</span><span class="o">.</span><span class="n">unmask</span><span class="p">(</span><span class="n">nodata_value</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">ee_img_scale</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">):</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The region must be a Feature or Geometry.&quot;</span><span class="p">)</span>

            <span class="n">img_collection</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">image_collection</span><span class="p">)</span><span class="o">.</span><span class="n">filterDate</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">date</span><span class="p">))</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span>

            <span class="n">ee_img_scale</span> <span class="o">=</span> <span class="n">img_collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">projection</span><span class="p">()</span><span class="o">.</span><span class="n">nominalScale</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

            <span class="n">mask</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

            <span class="n">img</span> <span class="o">=</span> <span class="n">img_collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>


            <span class="c1"># Step 1: Mask where value is not -9999</span>
            <span class="n">valid_pixels</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">neq</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span>

            <span class="c1"># Step 2: Combine valid_pixels mask with nigeria_mask</span>
            <span class="n">combined_mask</span> <span class="o">=</span> <span class="n">valid_pixels</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

            <span class="c1"># Step 3: Use the combined mask to mask the aggregated image</span>
            <span class="n">img_masked</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">combined_mask</span><span class="p">)</span>

            <span class="n">nodata_value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">img_masked</span><span class="o">.</span><span class="n">unmask</span><span class="p">(</span><span class="n">nodata_value</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">ee_img_scale</span></div>


<div class="viewcode-block" id="EarthEngineManager.split_and_sort_geometry">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.split_and_sort_geometry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">split_and_sort_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">num_sections</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param geometry: The geometry to be split and sorted.</span>
<span class="sd">        :param num_sections: The number of sections to split the geometry into.</span>
<span class="sd">        :return: A list of sorted grid cells obtained by splitting the geometry.</span>

<span class="sd">        This method takes a geometry and splits it into a grid of specified number of sections. The grid cells are then sorted based on their area in descending order.</span>

<span class="sd">        Example usage:</span>
<span class="sd">        ```</span>
<span class="sd">        geometry = ee.Geometry.Polygon(&lt;coordinates&gt;)</span>
<span class="sd">        num_sections = 4</span>

<span class="sd">        sorted_grid = split_and_sort_geometry(geometry, num_sections)</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">bounds</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Calculate dimensions for the grid</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_sections</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">x_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_cols</span>
        <span class="n">y_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_rows</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cols</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rows</span><span class="p">):</span>
                <span class="n">x_start</span> <span class="o">=</span> <span class="n">min_x</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">x_step</span>
                <span class="n">y_start</span> <span class="o">=</span> <span class="n">min_y</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">y_step</span>
                <span class="n">cell</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">([</span><span class="n">x_start</span><span class="p">,</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">x_start</span> <span class="o">+</span> <span class="n">x_step</span><span class="p">,</span> <span class="n">y_start</span> <span class="o">+</span> <span class="n">y_step</span><span class="p">])</span>
                <span class="n">intersected_cell</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">ErrorMargin</span><span class="p">(</span><span class="n">x_step</span><span class="p">))</span>
                <span class="n">grid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intersected_cell</span><span class="p">)</span>

        <span class="c1"># Sort the grid cells by area, largest first</span>
        <span class="n">sorted_grid</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">area</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sorted_grid</span></div>


<div class="viewcode-block" id="EarthEngineManager.get_image_download_url">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.get_image_download_url">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_download_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GEO_TIFF&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param region: The region of interest for the image download. It can be either an ee.Feature or ee.Geometry object.</span>
<span class="sd">        :param scale: The scale of the image. It can be either a numerical value or &#39;default&#39; to use the default scale of the image.</span>
<span class="sd">        :param img: The image to download.</span>
<span class="sd">        :param format: The format of the downloaded image. Default is &#39;GEO_TIFF&#39;.</span>
<span class="sd">        :param crs: The coordinate reference system of the downloaded image. Default is &#39;EPSG:4326&#39;.</span>
<span class="sd">        :return: The download URL for the image.</span>

<span class="sd">        This method takes in a region of interest, scale, image, format, and coordinate reference system (CRS) as parameters and returns the URL to download the image. The region can be specified</span>
<span class="sd">        * as an ee.Feature or ee.Geometry object. The scale can be provided as a numerical value or &#39;default&#39; to use the default scale of the image. The format parameter determines the format</span>
<span class="sd">        * in which the image will be downloaded, with the default being &#39;GEO_TIFF&#39;. The crs parameter specifies the CRS of the downloaded image, with the default being &#39;EPSG:4326&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">region</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The region must be a Feature or Geometry.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">projection</span><span class="p">()</span><span class="o">.</span><span class="n">nominalScale</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>


        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">getDownloadURL</span><span class="p">({</span>
            <span class="s1">&#39;region&#39;</span><span class="p">:</span> <span class="n">geometry</span><span class="p">,</span>
            <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
            <span class="s1">&#39;crs&#39;</span><span class="p">:</span> <span class="n">crs</span><span class="p">,</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="nb">format</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="EarthEngineManager.download_file_from_url">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.download_file_from_url">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_file_from_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download a file from the given URL.</span>

<span class="sd">        :param url: The URL of the file to be downloaded.</span>
<span class="sd">        :param destination_path: The path where the downloaded file will be saved.</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span></div>


<div class="viewcode-block" id="EarthEngineManager.img_min_max">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.img_min_max">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">img_min_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">min_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param img: The input image</span>
<span class="sd">        :param scale: The scale at which to compute the min and max values</span>
<span class="sd">        :param min_threshold: An optional threshold to exclude values below</span>
<span class="sd">        :param boundary: An optional geometry to limit the computation to a specific area</span>
<span class="sd">        :param band: The band to compute the min and max values for</span>
<span class="sd">        :return: The minimum and maximum values of the specified band as a tuple (min_value, max_value)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_pixels</span> <span class="o">=</span> <span class="mf">1e12</span>

        <span class="c1"># If a threshold is provided, mask the image to exclude values below the threshold</span>
        <span class="k">if</span> <span class="n">min_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="n">min_threshold</span><span class="p">))</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span>
            <span class="n">reducer</span><span class="o">=</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">minMax</span><span class="p">(),</span>
            <span class="n">bestEffort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
            <span class="n">geometry</span><span class="o">=</span><span class="n">boundary</span><span class="p">,</span>  <span class="c1"># Add this line</span>
            <span class="n">maxPixels</span><span class="o">=</span><span class="n">max_pixels</span>
        <span class="p">)</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

        <span class="n">min_value</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">_min&quot;</span><span class="p">]</span>
        <span class="n">max_value</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">_max&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span></div>


<div class="viewcode-block" id="EarthEngineManager.plot_image">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.plot_image">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">plot_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">vis_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot an image on a geemap.Map object.</span>

<span class="sd">        :param img: The image to be plotted.</span>
<span class="sd">        :param vis_params: The visualization parameters for the image.</span>
<span class="sd">        :return: The geemap.Map object with the image plotted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">center_lat</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">center_lon</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="n">zoomlevel</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="nb">map</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">],</span> <span class="n">zoom</span><span class="o">=</span><span class="n">zoomlevel</span><span class="p">)</span>
        <span class="nb">map</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">vis_params</span><span class="o">=</span><span class="n">vis_params</span><span class="p">)</span>
        <span class="nb">map</span><span class="o">.</span><span class="n">addLayerControl</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">map</span></div>


<div class="viewcode-block" id="EarthEngineManager.process_images">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.process_images">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">image_collection</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">country</span><span class="p">,</span> <span class="n">aggregation_type</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process images within a specified date range.</span>

<span class="sd">        :param start_date: The start date of the date range.</span>
<span class="sd">        :param end_date: The end date of the date range.</span>
<span class="sd">        :param image_collection: The collection of images to process.</span>
<span class="sd">        :param band: The desired band of the images.</span>
<span class="sd">        :param country: The country for which to process the images.</span>
<span class="sd">        :param aggregation_type: The type of aggregation for the images (either &quot;monthly&quot; or &quot;yearly&quot;).</span>
<span class="sd">        :param function: The function to apply to the images.</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Validate aggregation type</span>
        <span class="k">if</span> <span class="n">aggregation_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;monthly&quot;</span><span class="p">,</span> <span class="s2">&quot;yearly&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Aggregation type should be either &quot;monthly&quot; or &quot;yearly&quot;.&#39;</span><span class="p">)</span>

        <span class="c1"># Generate date ranges</span>
        <span class="k">if</span> <span class="n">aggregation_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;monthly&quot;</span><span class="p">:</span>
            <span class="n">date_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_monthly_date_ranges</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">date_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_yearly_date_ranges</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">start_date</span><span class="p">[:</span><span class="mi">4</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">date_ranges</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

            <span class="c1"># If the date range is within the specified start date and end date</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span>
                                                                                                      <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing images from </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

                <span class="c1"># Proceed to fetch and process image</span>
                <span class="n">img</span><span class="p">,</span> <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">end</span><span class="p">),</span> <span class="n">image_collection</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="n">country</span><span class="p">)</span>

                <span class="c1"># Generate download URL</span>
                <span class="n">download_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_download_url</span><span class="p">(</span><span class="n">boundary</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>

                <span class="c1"># Prompt the download URL</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Download URL: &quot;</span><span class="p">,</span> <span class="n">download_url</span><span class="p">)</span>

                <span class="c1"># Download the image</span>
                <span class="n">destination_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">.tif&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_file_from_url</span><span class="p">(</span><span class="n">download_url</span><span class="p">,</span> <span class="n">destination_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="EarthEngineManager.get_admin_units">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.get_admin_units">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_admin_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param level: An integer representing the administrative level. Default is 0.</span>
<span class="sd">        :return: A list of unique administrative units at the specified level.</span>

<span class="sd">        This method retrieves administrative units from a dataset based on the specified level. The dataset used is FAO/GAUL_SIMPLIFIED_500m/2015, which contains administrative boundary information</span>
<span class="sd">        *. The parameter &#39;level&#39; specifies the desired administrative level.</span>

<span class="sd">        If level is 0, the method returns a sorted list of unique country names found in the dataset.</span>

<span class="sd">        If level is 1 or 2, the method creates a dictionary where each key represents a higher-level unit and its value is a list of lower-level units. The dictionary is returned as a Python</span>
<span class="sd">        * dictionary.</span>

<span class="sd">        Note: This method utilizes the Earth Engine API to interact with geospatial data.</span>

<span class="sd">        Example usage:</span>
<span class="sd">            my_object = MyClass()</span>
<span class="sd">            result = my_object.get_admin_units(level=1)</span>

<span class="sd">            # Result may look like:</span>
<span class="sd">            {</span>
<span class="sd">                &#39;Country A&#39;: [&#39;Region 1&#39;, &#39;Region 2&#39;],</span>
<span class="sd">                &#39;Country B&#39;: [&#39;Region 3&#39;, &#39;Region 4&#39;],</span>
<span class="sd">                ...</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load the dataset</span>
        <span class="n">gaul_dataset</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAO/GAUL_SIMPLIFIED_500m/2015/level</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">unique_countries</span> <span class="o">=</span> <span class="n">gaul_dataset</span><span class="o">.</span><span class="n">aggregate_array</span><span class="p">(</span><span class="s1">&#39;ADM0_NAME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unique_countries</span><span class="o">.</span><span class="n">getInfo</span><span class="p">())</span>

        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Get the distinct higher-level units</span>
            <span class="n">unique_higher_level_units</span> <span class="o">=</span> <span class="n">gaul_dataset</span><span class="o">.</span><span class="n">aggregate_array</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ADM</span><span class="si">{</span><span class="n">level</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">_NAME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

            <span class="c1"># Create a FeatureCollection where each feature is a higher-level unit and its property is the list of lower-level units</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">process_higher_level_unit</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">prev</span><span class="p">):</span>
                <span class="n">prev</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>

                <span class="n">filtered_1</span> <span class="o">=</span> <span class="n">gaul_dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ADM</span><span class="si">{</span><span class="n">level</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">_NAME&#39;</span><span class="p">,</span> <span class="n">current</span><span class="p">))</span>
                <span class="n">lower_level_units_1</span> <span class="o">=</span> <span class="n">filtered_1</span><span class="o">.</span><span class="n">aggregate_array</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ADM</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s1">_NAME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">prev</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">lower_level_units_1</span><span class="p">)</span>

            <span class="n">admin_units_dict</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">(</span>
                <span class="n">ee</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">unique_higher_level_units</span><span class="o">.</span><span class="n">iterate</span><span class="p">(</span><span class="n">process_higher_level_unit</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">({}))))</span>

            <span class="k">return</span> <span class="n">admin_units_dict</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span></div>



<div class="viewcode-block" id="EarthEngineManager.get_image_sum">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.get_image_sum">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_image_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="s1">&#39;population&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param img: The input image to calculate the sum.</span>
<span class="sd">        :param geometry: The geometry to apply the calculation to.</span>
<span class="sd">        :param scale: The scale to use for calculation.</span>
<span class="sd">        :param band: The band to calculate the sum for. Defaults to &#39;population&#39;.</span>
<span class="sd">        :return: The sum value calculated for the specified band.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define the reducers for each statistic you want to calculate</span>

        <span class="n">reducers</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Apply the reducers to the image</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">reduceRegion</span><span class="p">(</span><span class="n">reducer</span><span class="o">=</span><span class="n">reducers</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">maxPixels</span><span class="o">=</span><span class="mf">1e12</span><span class="p">)</span>

        <span class="n">sum_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>  <span class="c1"># Make sure &#39;band&#39; is the correct key</span>

        <span class="k">return</span> <span class="n">sum_value</span></div>


<div class="viewcode-block" id="EarthEngineManager.ee_ensure_geometry">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.ee_ensure_geometry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ee_ensure_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param geometry: The input geometry to ensure that it is a valid Earth Engine Geometry.</span>
<span class="sd">        :return: Return the valid Earth Engine Geometry.</span>

<span class="sd">        Ensures that the input `geometry` is a valid Earth Engine Geometry. If the `geometry` is an</span>
<span class="sd">        instance of `ee.Feature`, it extracts the geometry from the feature and returns it. If the</span>
<span class="sd">        `geometry` is already an instance of `ee.Geometry`, it returns it directly. If the `geometry`</span>
<span class="sd">        is an instance of `ee.FeatureCollection`, it dissolves it into its outer boundary and returns</span>
<span class="sd">        the dissolved geometry. If the `geometry` is a dictionary, it assumes that it is a GeoJSON</span>
<span class="sd">        geometry and converts it to an Earth Engine Geometry before ensuring its validity. If the</span>
<span class="sd">        `geometry` is of any other type, it raises a `ValueError` with a specific error message</span>
<span class="sd">        indicating that the geometry type must be an Earth Engine Geometry, Feature, or FeatureCollection.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">geometry</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">geometry</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">):</span>
            <span class="c1"># Dissolve the FeatureCollection into its outer boundary</span>
            <span class="n">combined_geometry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
            <span class="n">dissolved_geometry</span> <span class="o">=</span> <span class="n">combined_geometry</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">maxError</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dissolved_geometry</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Assuming geojson is meant to be geometry (typo in the original code)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ee_ensure_geometry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_geojson_to_ee</span><span class="p">(</span><span class="n">geometry</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid geometry type. Must be an Earth Engine Geometry, Feature, or FeatureCollection.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EarthEngineManager.convert_geojson_to_ee">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.convert_geojson_to_ee">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">convert_geojson_to_ee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geojson_obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a GeoJSON object to Earth Engine objects.</span>

<span class="sd">        :param geojson_obj: The GeoJSON object to be converted.</span>
<span class="sd">        :return: The converted Earth Engine object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the GeoJSON type is not supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">geojson_obj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FeatureCollection&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">(</span><span class="n">geojson_obj</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">geojson_obj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Feature&#39;</span><span class="p">:</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">geojson_obj</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">geojson_obj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Polygon&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">,</span> <span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="s1">&#39;LineString&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiPoint&#39;</span><span class="p">,</span> <span class="s1">&#39;MultiLineString&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">geojson_obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported GeoJSON type&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EarthEngineManager.process_drawn_features">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.process_drawn_features">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_drawn_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawn_features</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param drawn_features: A list of drawn features, each representing a geometry or a feature in Google Earth Engine.</span>
<span class="sd">        :param layer: An Earth Engine asset layer to filter and retrieve distinct values from.</span>
<span class="sd">        :param column: The column or property in the asset layer for which to retrieve distinct values.</span>
<span class="sd">        :return: A list of distinct values from the specified column&quot;&quot;&quot;</span>
        <span class="n">all_distinct_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">drawn_features</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
                <span class="n">drawn_geom</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
                <span class="n">bounding</span> <span class="o">=</span> <span class="n">drawn_geom</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
                <span class="n">filtered_layer</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">filterBounds</span><span class="p">(</span><span class="n">bounding</span><span class="p">)</span>
                <span class="n">distinct_values</span> <span class="o">=</span> <span class="n">filtered_layer</span><span class="o">.</span><span class="n">aggregate_array</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
                <span class="n">all_distinct_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">distinct_values</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_distinct_values</span><span class="p">))</span></div>


<div class="viewcode-block" id="EarthEngineManager.process_geometry_collection">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.process_geometry_collection">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_geometry_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry_collection</span><span class="p">,</span> <span class="n">all_geometries</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process a geometry collection and extract polygon and multipolygon geometries</span>

<span class="sd">        :param geometry_collection: The input geometry collection to be processed</span>
<span class="sd">        :param all_geometries: List to store the extracted geometries</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometry_collection</span><span class="o">.</span><span class="n">geometries</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">geom</span> <span class="ow">in</span> <span class="n">geometries</span><span class="p">:</span>
            <span class="n">geom_type</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">geom_type</span> <span class="o">==</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">:</span>
                <span class="n">all_geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geom</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">geom_type</span> <span class="o">==</span> <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">geom</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]:</span>
                    <span class="n">all_geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span></div>


<div class="viewcode-block" id="EarthEngineManager.download_feature_geometry">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.download_feature_geometry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_feature_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distinct_values</span><span class="p">,</span> <span class="n">feature_type_prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">dropdown_api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_folder_location</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param distinct_values: A list of distinct values used to filter the features.</span>
<span class="sd">        :param feature_type_prefix: Optional prefix for the feature type.</span>
<span class="sd">        :param column: Optional column used for filtering the features.</span>
<span class="sd">        :param layer: A layer object containing the features.</span>
<span class="sd">        :param dropdown_api: Optional dropdown API type.</span>
<span class="sd">        :return: The geometry of the features or None if no valid geometries are found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">distinct_values</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No distinct values provided.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">feature_type_prefix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;watersheds&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid feature type.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">all_geometries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">distinct_values</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Filter</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">feature</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No feature found for value:&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">geometry</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No geometry for value:&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">geometry_type</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">type</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s1">&#39;Polygon&#39;</span><span class="p">:</span>
                <span class="n">all_geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">())</span>
            <span class="k">elif</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s1">&#39;MultiPolygon&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">poly</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">():</span>
                    <span class="n">all_geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">geometry_type</span> <span class="o">==</span> <span class="s1">&#39;GeometryCollection&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">process_geometry_collection</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">all_geometries</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">all_geometries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dissolved_geometry</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="o">.</span><span class="n">MultiPolygon</span><span class="p">(</span><span class="n">all_geometries</span><span class="p">)</span><span class="o">.</span><span class="n">dissolve</span><span class="p">()</span>
                <span class="n">feature</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">(</span><span class="n">dissolved_geometry</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ee</span><span class="o">.</span><span class="n">EEException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error creating dissolved geometry:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No valid geometries to dissolve.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">feature</span> <span class="ow">and</span> <span class="n">dropdown_api</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;glofas&#39;</span><span class="p">,</span> <span class="s1">&#39;modis_nrt&#39;</span><span class="p">]:</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
            <span class="n">geom_location</span> <span class="o">=</span> <span class="s1">&#39;geometry.geojson&#39;</span> <span class="k">if</span> <span class="n">output_folder_location</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder_location</span><span class="p">,</span> <span class="s1">&#39;geometry.geojson&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">geom_location</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">geometry</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">geometry</span></div>


<div class="viewcode-block" id="EarthEngineManager.download_and_split">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.download_and_split">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_and_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">original_geometry</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">split_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param image: The image identifier.</span>
<span class="sd">        :param original_geometry: The original geometry of the image.</span>
<span class="sd">        :param scale: The scale of the image.</span>
<span class="sd">        :param split_count: The number of splits to divide the image into (default is 1).</span>
<span class="sd">        :param params: Additional parameters (default is None).</span>
<span class="sd">        :param band: The band of the image (default is None).</span>
<span class="sd">        :return: A list of file names and a boolean indicating if the download was successful.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">geom_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_and_sort_geometry</span><span class="p">(</span><span class="n">original_geometry</span><span class="p">,</span> <span class="n">split_count</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">geom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">geom_list</span><span class="p">):</span>
                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_download_url</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">split_count</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span>
                                                                                                                <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;folder_output&#39;</span><span class="p">],</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_file_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">destination_path</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
                <span class="n">file_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">split_count</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_names</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Download successful without splitting, no need to mosaic</span>
                <span class="k">return</span> <span class="n">file_names</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Total request size&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Splitting geometry into </span><span class="si">{</span><span class="n">split_count</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2"> parts and trying again.&quot;</span><span class="p">)</span>
                <span class="c1"># Increase split count and try again</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_and_split</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">original_geometry</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">split_count</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">band</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unexpected error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">file_names</span><span class="p">,</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="EarthEngineManager.ee_geometry_to_shapely">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.ee_geometry_to_shapely">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">ee_geometry_to_shapely</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an Earth Engine Geometry or Feature, or a GeoJSON dictionary, to a Shapely Geometry.</span>

<span class="sd">        :param geometry: An Earth Engine Geometry or Feature, or a GeoJSON dictionary.</span>
<span class="sd">        :return: A Shapely Geometry object.</span>

<span class="sd">        Examples:</span>
<span class="sd">            # Convert an Earth Engine Geometry</span>
<span class="sd">            ee_geometry_to_shapely(ee_object)</span>

<span class="sd">            # Convert a GeoJSON dictionary</span>
<span class="sd">            geo_json = {</span>
<span class="sd">                &quot;type&quot;: &quot;Point&quot;,</span>
<span class="sd">                &quot;coordinates&quot;: [0, 0]</span>
<span class="sd">            }</span>
<span class="sd">            ee_geometry_to_shapely(geo_json)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if the geometry is an Earth Engine Geometry or Feature</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Geometry</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Feature</span><span class="p">):</span>
            <span class="c1"># Convert Earth Engine object to GeoJSON</span>
            <span class="n">geo_json</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="n">geo_json</span><span class="p">:</span>  <span class="c1"># If it&#39;s a Feature, extract the geometry part</span>
                <span class="n">geo_json</span> <span class="o">=</span> <span class="n">geo_json</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
            <span class="c1"># Convert GeoJSON to a Shapely Geometry</span>
            <span class="k">return</span> <span class="n">shape</span><span class="p">(</span><span class="n">geo_json</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>  <span class="c1"># Directly convert from GeoJSON if it&#39;s a dictionary</span>
            <span class="k">return</span> <span class="n">shape</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If it&#39;s neither, assume it&#39;s already a Shapely Geometry or compatible</span>
            <span class="k">return</span> <span class="n">geometry</span></div>


<div class="viewcode-block" id="EarthEngineManager.determine_geometries_to_process">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineManager.determine_geometries_to_process">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">determine_geometries_to_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">override_boundary_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dropdown_api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">boundary_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">draw_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">userlayers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundary_layer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">output_folder_location</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param override_boundary_type: (optional) Type of boundary to override the default boundary type.</span>
<span class="sd">        :type override_boundary_type: str</span>
<span class="sd">        :param layer: (optional) Name of the layer to use for processing features.</span>
<span class="sd">        :type layer: str</span>
<span class="sd">        :param column: (optional) Name of the column to use for processing features.</span>
<span class="sd">        :type column: str</span>
<span class="sd">        :param dropdown_api: (optional) API to retrieve dropdown values.</span>
<span class="sd">        :type dropdown_api: str</span>
<span class="sd">        :param boundary_type: (optional) Type of boundary to process.</span>
<span class="sd">        :type boundary_type: str</span>
<span class="sd">        :param draw_features: (optional) List of features drawn by the user.</span>
<span class="sd">        :type draw_features: list</span>
<span class="sd">        :param userlayers: (optional) Dictionary of user uploaded layers.</span>
<span class="sd">        :type userlayers: dict</span>
<span class="sd">        :param boundary_layer: (optional) Layer name for user defined boundary.</span>
<span class="sd">        :type boundary_layer: str</span>
<span class="sd">        :return: List of geometries to process.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geometries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">override_boundary_type</span><span class="p">:</span>
            <span class="n">boundary_type</span> <span class="o">=</span> <span class="n">override_boundary_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">boundary_type</span> <span class="o">=</span> <span class="n">boundary_type</span>
        <span class="k">if</span> <span class="n">boundary_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Predefined Boundaries&#39;</span><span class="p">,</span> <span class="s1">&#39;User Defined&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">draw_features</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">boundary_type</span> <span class="o">==</span> <span class="s1">&#39;Predefined Boundaries&#39;</span><span class="p">:</span>
                    <span class="n">distinct_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_drawn_features</span><span class="p">([</span><span class="n">feature</span><span class="p">],</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">)</span>
                    <span class="n">feature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_feature_geometry</span><span class="p">(</span><span class="n">distinct_values</span><span class="p">,</span> <span class="n">feature_type_prefix</span><span class="o">=</span><span class="n">boundary_layer</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">column</span><span class="o">=</span><span class="n">column</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">,</span> <span class="n">dropdown_api</span><span class="o">=</span><span class="n">dropdown_api</span><span class="p">,</span>
                                                             <span class="n">output_folder_location</span><span class="o">=</span><span class="n">output_folder_location</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># User Defined</span>
                    <span class="n">distinct_values</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># Assuming feature is the geometry itself in this case</span>
                <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">feature</span><span class="p">,</span> <span class="n">distinct_values</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">boundary_type</span> <span class="o">==</span> <span class="s1">&#39;User Uploaded Data&#39;</span> <span class="ow">and</span> <span class="s1">&#39;User Uploaded Data&#39;</span> <span class="ow">in</span> <span class="n">userlayers</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">userlayers</span><span class="p">[</span><span class="s1">&#39;User Uploaded Data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">feature</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">geometries</span></div>
</div>



<div class="viewcode-block" id="EarthEngineNotebookInterface">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">EarthEngineNotebookInterface</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<div class="viewcode-block" id="EarthEngineNotebookInterface.Config">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface.Config">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Config</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class represents a configuration object.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            extra (Extra): Specifies whether to allow extra fields in the configuration.</span>

<span class="sd">        Enum:</span>
<span class="sd">            Extra:</span>
<span class="sd">                - allow: Allows extra fields in the configuration.</span>
<span class="sd">                - disallow: Disallows extra fields in the configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="n">Extra</span><span class="o">.</span><span class="n">allow</span>  <span class="c1"># Allow extra fields</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the object with the given parameters.</span>

<span class="sd">        :param data: The data used to initialize the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_widget</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_widgets_gee</span><span class="p">()</span>

<div class="viewcode-block" id="EarthEngineNotebookInterface.on_gee_search_button_clicked">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface.on_gee_search_button_clicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_gee_search_button_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the click event of the Google Earth Engine search button.</span>

<span class="sd">        :param b: The button object that was clicked.</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Here you define what happens when the button is clicked.</span>
        <span class="c1"># For now, it&#39;s just a print statement.</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">geemap</span><span class="o">.</span><span class="n">search_ee_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_widget</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Button clicked: Searching for&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_widget</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_results_dropdown</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">}</span></div>



<div class="viewcode-block" id="EarthEngineNotebookInterface.on_gee_layer_selected">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface.on_gee_layer_selected">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_gee_layer_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to handle the selection of a Google Earth Engine layer.</span>

<span class="sd">        :param b: The event object triggered by the selection.</span>
<span class="sd">        :type b: object</span>

<span class="sd">        :return: None</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected_layer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_results_dropdown</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ee_dates_min_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_collection_dates</span><span class="p">(</span><span class="n">selected_layer</span><span class="p">,</span> <span class="n">min_max_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_bands_search_results</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="n">selected_layer</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">bandNames</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span></div>


<div class="viewcode-block" id="EarthEngineNotebookInterface.on_single_or_range_dates_change">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface.on_single_or_range_dates_change">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">on_single_or_range_dates_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to handle changes in the selection of single or range dates.</span>

<span class="sd">        :param change: The change event triggered by the selection.</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_or_range_dates</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;Single Date&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gee_single_date_selector</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="n">options</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Results:&#39;</span><span class="p">,</span>
                <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gee_single_date_selector</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_collection_dates</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_results_dropdown</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">min_max_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_selection</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gee_single_date_selector</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_or_range_dates</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;Date Range&#39;</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ee_dates_min_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ee_dates_min_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_picker_start</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">DatePicker</span><span class="p">(</span>
                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Select Start Date:&#39;</span><span class="p">,</span>
                <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="nb">max</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">start_date</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_picker_end</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">DatePicker</span><span class="p">(</span>
                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Select End Date:&#39;</span><span class="p">,</span>
                <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="nb">max</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">end_date</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gee_multi_date_aggregation_periods</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span>
                <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Monthly&#39;</span><span class="p">,</span> <span class="s1">&#39;Yearly&#39;</span><span class="p">,</span> <span class="s1">&#39;All Images&#39;</span><span class="p">,</span> <span class="s1">&#39;One Aggregation&#39;</span><span class="p">],</span>
                <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;Monthly&#39;</span><span class="p">,</span>
                <span class="n">tooltips</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Monthly&#39;</span><span class="p">,</span> <span class="s1">&#39;Yearly&#39;</span><span class="p">,</span> <span class="s1">&#39;All Images&#39;</span><span class="p">,</span> <span class="s1">&#39;One Aggregation&#39;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="n">aggregation_values</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">mode</span><span class="p">(),</span>
                <span class="s1">&#39;median&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
                <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">Reducer</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
                <span class="s1">&#39;first&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;system:time_start&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">(),</span>
                <span class="s1">&#39;last&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">ic</span><span class="p">:</span> <span class="n">ic</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s1">&#39;system:time_start&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="p">(),</span>
                <span class="c1"># &#39;none&#39;: lambda ic: ic</span>
            <span class="p">}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">gee_multi_date_aggregation_method</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
                <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">():</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">aggregation_values</span><span class="o">.</span><span class="n">keys</span><span class="p">()},</span>
                <span class="n">value</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Aggregation Method:&#39;</span><span class="p">,</span>
                <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_selection</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">gee_date_picker_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_picker_end</span><span class="p">]),</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">gee_multi_date_aggregation_periods</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">gee_multi_date_aggregation_method</span><span class="p">]</span></div>


<div class="viewcode-block" id="EarthEngineNotebookInterface.create_widgets_gee">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface.create_widgets_gee">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_widgets_gee</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :create_widgets_gee method creates and configures the GEE widgets used for searching layers, selecting layers, selecting bands, and setting processing options.</span>

<span class="sd">        :return:  A list of the configured GEE widgets.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_widget</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Search for a layer&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Search:&#39;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_button</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Search&#39;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># &#39;success&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;danger&#39; or &#39;&#39;</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Click to search&#39;</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;search&#39;</span>  <span class="c1"># Icons names are available at https://fontawesome.com/icons</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_button</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">button_color</span> <span class="o">=</span> <span class="s1">&#39;#c8102e&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_button</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">text_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_gee_search_button_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">search_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_widget</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_button</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_results_dropdown</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Results:&#39;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">select_layer_gee</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Select&#39;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">button_style</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="c1"># &#39;success&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;danger&#39; or &#39;&#39;</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;Select Layer&#39;</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;crosshairs&#39;</span>  <span class="c1"># Icons names are available at https://fontawesome.com/icons</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">select_layer_gee</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">button_color</span> <span class="o">=</span> <span class="s1">&#39;#c8102e&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_layer_gee</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">text_color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">select_layer_gee</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_gee_layer_selected</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">layer_select_box</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_results_dropdown</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_layer_gee</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_bands_search_results</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Bands:&#39;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">single_or_range_dates</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Single Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Date Range&#39;</span><span class="p">],</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="s1">&#39;Date Range&#39;</span><span class="p">,</span>
            <span class="n">tooltips</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Single Date&#39;</span><span class="p">,</span> <span class="s1">&#39;Date Range&#39;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_image_to_map</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Add Image to Map&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filechooser</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">FileChooser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">show_only_dirs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_sub_folder</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Create Sub-folder&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">single_or_range_dates</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_single_or_range_dates_change</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_layer_gee</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_single_or_range_dates_change</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_selection</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">statistics_only_check</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Image Statistics Only (dictionary)&#39;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">indent</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale_input</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
            <span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Scale&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Scale:&#39;</span><span class="p">,</span>
            <span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="n">Layout</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_end_of_container_options</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Accordion</span><span class="p">(</span>
            <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">TwoByTwoLayout</span><span class="p">(</span>
                <span class="n">top_left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">statistics_only_check</span><span class="p">,</span> <span class="n">top_right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_image_to_map</span><span class="p">,</span>
                <span class="n">bottom_right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">create_sub_folder</span>
            <span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gee_end_of_container_options</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Processing Options&#39;</span><span class="p">)</span>

        <span class="n">widget_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">search_box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_select_box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_bands_search_results</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">single_or_range_dates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_selection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_input</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filechooser</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">gee_end_of_container_options</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widget_list</span><span class="p">:</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span>

        <span class="k">return</span> <span class="n">widget_list</span></div>


<div class="viewcode-block" id="EarthEngineNotebookInterface.process_api">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface.process_api">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">distinct_values</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param geometry: The geometry for which to retrieve the image data.</span>
<span class="sd">        :param distinct_values: Whether to retrieve distinct values or not.</span>
<span class="sd">        :param index: The index of the distinct value to retrieve.</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">:</span>
            <span class="n">gee_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gather_gee_parameters</span><span class="p">()</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">gee_params</span><span class="p">)</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ee_ensure_geometry</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;multi_date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">img</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="o">**</span><span class="n">gee_params</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_download_url</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span>
                <span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;gee_image.tif&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_file_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">destination_path</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
                <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">no_data_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raster_min_max</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_bands_search_results</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ndvi&#39;</span><span class="p">,</span> <span class="s1">&#39;evi&#39;</span><span class="p">]:</span>
                    <span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FFFFFF&#39;</span><span class="p">,</span> <span class="s1">&#39;CE7E45&#39;</span><span class="p">,</span> <span class="s1">&#39;DF923D&#39;</span><span class="p">,</span> <span class="s1">&#39;F1B555&#39;</span><span class="p">,</span> <span class="s1">&#39;FCD163&#39;</span><span class="p">,</span> <span class="s1">&#39;99B718&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;74A901&#39;</span><span class="p">,</span> <span class="s1">&#39;66A000&#39;</span><span class="p">,</span> <span class="s1">&#39;529400&#39;</span><span class="p">,</span> <span class="s1">&#39;3E8601&#39;</span><span class="p">,</span> <span class="s1">&#39;207401&#39;</span><span class="p">,</span> <span class="s1">&#39;056201&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;004C00&#39;</span><span class="p">,</span> <span class="s1">&#39;023B01&#39;</span><span class="p">,</span> <span class="s1">&#39;012E01&#39;</span><span class="p">,</span> <span class="s1">&#39;011D01&#39;</span><span class="p">,</span> <span class="s1">&#39;011301&#39;</span><span class="p">]</span>
                    <span class="n">vis_params</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                        <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">palette</span><span class="p">,</span>
                        <span class="s1">&#39;nodata&#39;</span><span class="p">:</span> <span class="n">no_data_val</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vis_params</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span>
                        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span>
                        <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;nodata&#39;</span><span class="p">:</span> <span class="n">no_data_val</span>
                    <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">vis_params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;aggregation_period&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Monthly&#39;</span><span class="p">:</span>
                    <span class="n">monthly_date_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_monthly_date_ranges</span><span class="p">(</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span>
                                                                                   <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;statistics_only&#39;</span><span class="p">]:</span>
                        <span class="n">all_stats</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">monthly_date_ranges</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;statistics_only&#39;</span><span class="p">]:</span>
                            <span class="n">image</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">multi_date</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                    <span class="n">aggregation_method</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                        <span class="s1">&#39;aggregation_method&#39;</span><span class="p">],</span>
                                                                    <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                    <span class="n">end_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                    <span class="n">band</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">],</span>
                                                                    <span class="n">image_collection</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                        <span class="s1">&#39;image_collection&#39;</span><span class="p">])</span>
                            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_statistics</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">gee_params</span><span class="p">[</span>
                                <span class="s1">&#39;band&#39;</span><span class="p">])</span>  <span class="c1"># This should be a server-side object</span>
                            <span class="n">all_stats</span> <span class="o">=</span> <span class="n">all_stats</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stats</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">img</span><span class="p">,</span> <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">multi_date</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                  <span class="n">aggregation_method</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                      <span class="s1">&#39;aggregation_method&#39;</span><span class="p">],</span>
                                                                  <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                  <span class="n">end_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                  <span class="n">band</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">],</span>
                                                                  <span class="n">image_collection</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                      <span class="s1">&#39;image_collection&#39;</span><span class="p">])</span>
                            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_download_url</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">boundary</span><span class="p">,</span>
                                                                     <span class="n">scale</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span>
                            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;image_collection&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;aggregation_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">download_file_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">destination_path</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;statistics_only&#39;</span><span class="p">]:</span>
                        <span class="n">all_stats_info</span> <span class="o">=</span> <span class="n">all_stats</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">all_stats_info</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;aggregation_period&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Yearly&#39;</span><span class="p">:</span>
                    <span class="n">yearly_date_ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_yearly_date_ranges</span><span class="p">(</span>
                        <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">],</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;statistics_only&#39;</span><span class="p">]:</span>
                        <span class="n">all_stats</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Dictionary</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">dates</span> <span class="ow">in</span> <span class="n">yearly_date_ranges</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;statistics_only&#39;</span><span class="p">]:</span>
                            <span class="n">image</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">multi_date</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                    <span class="n">aggregation_method</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                        <span class="s1">&#39;aggregation_method&#39;</span><span class="p">],</span>
                                                                    <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                    <span class="n">end_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                    <span class="n">band</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">],</span>
                                                                    <span class="n">image_collection</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                        <span class="s1">&#39;image_collection&#39;</span><span class="p">])</span>
                            <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_statistics</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">gee_params</span><span class="p">[</span>
                                <span class="s1">&#39;band&#39;</span><span class="p">])</span>  <span class="c1"># This should be a server-side object</span>
                            <span class="n">all_stats</span> <span class="o">=</span> <span class="n">all_stats</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stats</span><span class="p">)</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">img</span><span class="p">,</span> <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">multi_date</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                  <span class="n">aggregation_method</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                      <span class="s1">&#39;aggregation_method&#39;</span><span class="p">],</span>
                                                                  <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                  <span class="n">end_date</span><span class="o">=</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                                  <span class="n">band</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">],</span>
                                                                  <span class="n">image_collection</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                                      <span class="s1">&#39;image_collection&#39;</span><span class="p">])</span>
                            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_download_url</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">boundary</span><span class="p">,</span>
                                                                     <span class="n">scale</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span>
                            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;image_collection&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;aggregation_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">download_file_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">destination_path</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;statistics_only&#39;</span><span class="p">]:</span>
                        <span class="n">all_stats_info</span> <span class="o">=</span> <span class="n">all_stats</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
                        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">all_stats_info</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;aggregation_period&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;One Aggregation&#39;</span><span class="p">:</span>
                    <span class="n">img</span><span class="p">,</span> <span class="n">boundary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">multi_date</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                          <span class="n">aggregation_method</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                              <span class="s1">&#39;aggregation_method&#39;</span><span class="p">],</span>
                                                          <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span>
                                                          <span class="n">start_date</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">]),</span>
                                                          <span class="n">end_date</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">]),</span>
                                                          <span class="n">band</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;band&#39;</span><span class="p">],</span>
                                                          <span class="n">image_collection</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span>
                                                              <span class="s1">&#39;image_collection&#39;</span><span class="p">])</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_download_url</span><span class="p">(</span><span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">boundary</span><span class="p">,</span>
                                                             <span class="n">scale</span><span class="o">=</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span>

                    <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;image_collection&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;start_date&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;end_date&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">gee_params</span><span class="p">[</span><span class="s1">&#39;aggregation_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">download_file_from_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">destination_path</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
                    <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">no_data_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_raster_min_max</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_bands_search_results</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ndvi&#39;</span><span class="p">,</span> <span class="s1">&#39;evi&#39;</span><span class="p">]:</span>
                        <span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FFFFFF&#39;</span><span class="p">,</span> <span class="s1">&#39;CE7E45&#39;</span><span class="p">,</span> <span class="s1">&#39;DF923D&#39;</span><span class="p">,</span> <span class="s1">&#39;F1B555&#39;</span><span class="p">,</span> <span class="s1">&#39;FCD163&#39;</span><span class="p">,</span> <span class="s1">&#39;99B718&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;74A901&#39;</span><span class="p">,</span> <span class="s1">&#39;66A000&#39;</span><span class="p">,</span> <span class="s1">&#39;529400&#39;</span><span class="p">,</span> <span class="s1">&#39;3E8601&#39;</span><span class="p">,</span> <span class="s1">&#39;207401&#39;</span><span class="p">,</span> <span class="s1">&#39;056201&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;004C00&#39;</span><span class="p">,</span> <span class="s1">&#39;023B01&#39;</span><span class="p">,</span> <span class="s1">&#39;012E01&#39;</span><span class="p">,</span> <span class="s1">&#39;011D01&#39;</span><span class="p">,</span> <span class="s1">&#39;011301&#39;</span><span class="p">]</span>
                        <span class="n">vis_params</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                            <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="n">palette</span><span class="p">,</span>
                            <span class="s1">&#39;nodata&#39;</span><span class="p">:</span> <span class="n">no_data_val</span>
                        <span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vis_params</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">min_val</span><span class="p">,</span>
                            <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">max_val</span><span class="p">,</span>
                            <span class="s1">&#39;palette&#39;</span><span class="p">:</span> <span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;nodata&#39;</span><span class="p">:</span> <span class="n">no_data_val</span>
                        <span class="p">}</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">vis_params</span><span class="p">)</span>
                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EarthEngineNotebookInterface.gather_parameters">
<a class="viewcode-back" href="../../APIs.html#APIs.EarthEngine.EarthEngineNotebookInterface.gather_parameters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gather_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gathers the parameters required for processing.</span>

<span class="sd">        :return: A dictionary containing the gathered parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_layer_search_results_dropdown</span><span class="o">.</span><span class="n">value</span>
        <span class="n">date_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">single_or_range_dates</span><span class="o">.</span><span class="n">value</span>
        <span class="n">band</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_bands_search_results</span><span class="o">.</span><span class="n">value</span>
        <span class="n">statistics_only</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">statistics_only_check</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_input</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_input</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">add_image_to_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_to_map_check</span><span class="o">.</span><span class="n">value</span>
        <span class="n">create_sub_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sub_folder</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="n">date_type</span> <span class="o">==</span> <span class="s1">&#39;Single Date&#39;</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_single_date_selector</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_to_map_check</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_to_map_check</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;statistics_only&#39;</span><span class="p">:</span> <span class="n">statistics_only</span><span class="p">,</span>
                <span class="s1">&#39;image_collection&#39;</span><span class="p">:</span> <span class="n">image_collection</span><span class="p">,</span>
                <span class="s1">&#39;multi_date&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;band&#39;</span><span class="p">:</span> <span class="n">band</span><span class="p">,</span>
                <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span>
                <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s1">&#39;create_sub_folder&#39;</span><span class="p">:</span> <span class="n">create_sub_folder</span><span class="p">,</span>
                <span class="s1">&#39;add_to_map&#39;</span><span class="p">:</span> <span class="n">add_image_to_map</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">date_type</span> <span class="o">==</span> <span class="s1">&#39;Date Range&#39;</span><span class="p">:</span>
            <span class="n">aggregation_period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_multi_date_aggregation_periods</span><span class="o">.</span><span class="n">value</span>
            <span class="n">aggregation_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_multi_date_aggregation_method</span><span class="o">.</span><span class="n">value</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_picker_start</span><span class="o">.</span><span class="n">value</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_date_picker_end</span><span class="o">.</span><span class="n">value</span>
            <span class="n">band</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gee_bands_search_results</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_to_map_check</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_to_map_check</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;statistics_only&#39;</span><span class="p">:</span> <span class="n">statistics_only</span><span class="p">,</span>
                <span class="s1">&#39;image_collection&#39;</span><span class="p">:</span> <span class="n">image_collection</span><span class="p">,</span>
                <span class="s1">&#39;multi_date&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;aggregation_period&#39;</span><span class="p">:</span> <span class="n">aggregation_period</span><span class="p">,</span>
                <span class="s1">&#39;aggregation_method&#39;</span><span class="p">:</span> <span class="n">aggregation_method</span><span class="p">,</span>
                <span class="s1">&#39;start_date&#39;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
                <span class="s1">&#39;band&#39;</span><span class="p">:</span> <span class="n">band</span><span class="p">,</span>
                <span class="s1">&#39;end_date&#39;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">,</span>
                <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">scale</span><span class="p">,</span>
                <span class="s1">&#39;create_sub_folder&#39;</span><span class="p">:</span> <span class="n">create_sub_folder</span><span class="p">,</span>
                <span class="s1">&#39;add_to_map&#39;</span><span class="p">:</span> <span class="n">add_image_to_map</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>
</div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Mercy Corps.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>